<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/template/template.xhtml">



    <ui:define name="content">

        <h:form id="updateDependantForm">

            <p:dialog  widgetVar="updateDependantDialog" modal="true" resizable="false">
                <p:panel header="Update Dependant #{dependantdisplaybean.username}" styleClass="login-panel">
                    <p:messages id="messages" autoUpdate="true" closable="true" />
                    <p:panelGrid columns="2" id="content" style="margin-bottom: 10px;" columnClasses="label, value">
                        <h:outputLabel for="UserName" value= "Username: "/>
                        <h:inputText id="UserName" value="#{savedependantbean.username}" disabled="true" required="true" label ="Username"/>
                        <h:outputLabel for="FirstName" value= "Firstname: "/>
                        <h:inputText id="FirstName" value="#{savedependantbean.firstname}" required="true" label ="Firstname"/>
                        <h:outputLabel for="LastName" value="Lastname: "/>
                        <h:inputText id="LastName" value="#{savedependantbean.lastname}" required="false" label ="Lastname"/>
                        <h:outputLabel for="gender" value="Gender: " />
                        <p:selectOneRadio id="gender" value="#{savedependantbean.gender}" required="true" label="gender">
                            <f:selectItem itemLabel="Male" itemValue="male" />
                            <f:selectItem itemLabel="Female" itemValue="female" />
                        </p:selectOneRadio>
                        <h:outputLabel for="DateOfBirth" value="Birthdate: "/>
                        <p:calendar id="DateOfBirth" value="#{savedependantbean.dateOfBirth}" pattern="yyyy-MM-dd" required="true">
                            <f:convertDateTime pattern="yyyy-MM-dd" />
                        </p:calendar>
                    </p:panelGrid>
                    <p:commandButton value="Update" action="#{savedependantbean.updateDependant(savedependantbean.firstname,savedependantbean.lastname,savedependantbean.username,savedependantbean.dateOfBirth,savedependantbean.gender)}" update=":updateDependantForm @form" oncomplete="handleDialog3Close();" styleClass="ui-button-primary" style="width: 100%;" />
                </p:panel>
            </p:dialog>
        </h:form>





        <ui:fragment rendered="#{saveuserbean.isAdmin()}">
        <h:form class="autoMargin">
            <h1>System has the following dependants</h1>
            <h:panelGrid columns="3">
                <h:outputLabel for="searchUsername" value="Filter by name or gender: " />
                <h:inputText id="searchUsername" value="#{dependantdisplaybean.attribute}" >
                    <f:ajax event="keyup" render="results" listener="dependantdisplaybean.searchDependantByName(dependantdisplaybean.attribute)"/>
                </h:inputText>
                <h:commandButton value="Delete all" onclick="return confirm('Are you sure you want to delete all dependants?');" action="#{savedependantbean.deleteAllDependants()}" styleClass="ui-button ui-widget ui-state-default ui-corner-all" style="padding: 9.7px;color: red; font-size: 12px"/>

            </h:panelGrid>
            <p:dataTable scrollable="true" id="results" paginator="true" rows="5" paginatorPosition="bottom" styleClass="ui-datatable-scrollable-body" value="#{dependantdisplaybean.searchDependantByName(dependantdisplaybean.attribute)}" var= "dependant" emptyMessage="No Dependants found">
                <p:column headerText="User name">
                    #{dependant.username}
                </p:column>
                <p:column headerText="First name">
                    #{dependant.firstname}
                </p:column>
                <p:column headerText="Last name">
                    #{dependant.lastname}
                </p:column>
                <p:column headerText="Date of birth">
                    #{dependantdisplaybean.dateFormat(dependant.dateOfBirth)}
                </p:column>
                <p:column headerText="Gender">
                    #{dependant.gender}
                </p:column>
                <p:column headerText="Actions">
                    <h:commandButton style="color: red; font-size: 10px" value="Delete" onclick="return confirm('Are you sure You want to completely delete this dependant from database?');" action ="#{savedependantbean.deleteDependant(dependant.username)}" outcome ="/pages/protected/dependants/dependants_all.xhtml"/>  <span></span>
                    <h:commandButton value="SoftDelete" onclick="return confirm('Are you sure You want to mark this dependant as deleted in database?');" action ="#{savedependantbean.softDeleteDependant(dependant.username)}"  style="color: orangered;font-size: 10px" outcome = "/pages/protected/dependants/dependants.xhtml?id=#{dependantdisplaybean.user_id}"/>  <span></span>
                    <p:commandButton style = "color:green ; font-size: 9px; padding: 1px" value="Update" styleClass="ui-button ui-widget ui-state-default ui-corner-all" onclick="showDialog3();" update=":updateDependantForm:content" >
                        <f:setPropertyActionListener value="#{dependant.username}" target="#{savedependantbean.username}" />
                        <f:setPropertyActionListener value="#{dependant.firstname}" target="#{savedependantbean.firstname}" />
                        <f:setPropertyActionListener value="#{dependant.lastname}" target="#{savedependantbean.lastname}" />
                        <f:setPropertyActionListener value="#{dependant.gender}" target="#{savedependantbean.gender}" />
                        <f:setPropertyActionListener value="#{dependant.dateOfBirth}" target="#{savedependantbean.dateOfBirth}" />

                    </p:commandButton>

                </p:column>
            </p:dataTable>
        </h:form>
    </ui:fragment>
        <ui:fragment rendered="#{not saveuserbean.isAdmin()}"  >
            <script>
                window.alert("you are not authorized to view this page")
                window.location.href = '/user_registration_app_war_exploded/pages/protected/home/home.xhtml';
            </script>
        </ui:fragment>

    </ui:define>
</ui:composition>
